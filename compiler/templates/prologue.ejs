(function() {
  Object.prototype.extend = function(obj) {
    return obj;
  };

  // TODO: handle negative step
  Array.prototype.step = function(step) {
    var ret = [];
    for(var i = 0; i < this.length; i += step)
      ret.push(this[i]);
    return ret;
  };

  Array.prototype.each = function(it) {
    for(var i = 0; i < this.length; i++) {
      it(this[i]);
    }
  };

  Array.prototype.map = function(m) {
    var ret = [];
    this.each(function(it) { ret.push(m(it)); });
    return ret;
  }

  Array.prototype.filter = function(f) {
    var ret = [];
    this.each(function(it) { if(f(it)) ret.push(it); });
    return ret;
  }

  <%= body %>
})();